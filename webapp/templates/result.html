{% extends "base.html" %}
{% block content %}
<div class="container animate-results" style="margin-top: 100px; margin-bottom: 50px;">
    
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="heading-glass m-0">Search Results</h2>
        <a href="{{ url_for('routes1.dashboard') }}" class="btn btn-outline-primary rounded-pill">
            <i class="fa-solid fa-arrow-left me-2"></i> Back to Dashboard
        </a>
    </div>

    <div class="glass-btn-card p-4 mb-4" style="background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.2);">
        <p class="mb-0 text-muted">Found <strong>{{ length }}</strong> results for <span class="badge bg-primary rounded-pill px-3">"{{ query }}"</span></p>
    </div>
    
    {% if length == 0 %}
        <div class="glass-card p-5 text-center mx-auto" style="max-width: 500px;">
            <i class="fa-solid fa-magnifying-glass fa-3x text-muted mb-3 opacity-50"></i>
            <h3>No Results Found</h3>
            <p class="text-muted">We couldn't find anything matching your search. Try different keywords or check your spelling.</p>
        </div>
    {% else %}
        
        <!-- Tabs for filtering results -->
        <ul class="nav nav-pills mb-4 justify-content-center" id="searchTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active rounded-pill px-4 me-2 shadow-sm" id="summaries-tab" data-bs-toggle="pill" data-bs-target="#summaries" type="button" role="tab">
                    <i class="fa-solid fa-file-lines me-2"></i> Summaries ({{ texts|length }})
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link rounded-pill px-4 shadow-sm" id="chats-tab" data-bs-toggle="pill" data-bs-target="#chats" type="button" role="tab">
                    <i class="fa-solid fa-comments me-2"></i> Chat History ({{ chats|length }})
                </button>
            </li>
        </ul>

        <div class="tab-content" id="searchTabsContent">
            <!-- Summaries Tab -->
            <div class="tab-pane fade show active" id="summaries" role="tabpanel">
                {% if texts|length > 0 %}
                <div class="row g-4">
                    {% for text in texts %}
                    <div class="col-md-6 col-lg-4">
                        <div class="glass-card h-100 p-4 d-flex flex-column border-top border-4 border-warning shadow-sm">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <span class="badge bg-warning text-dark rounded-pill">{{text.type|default('Text')}}</span>
                                <small class="text-muted"><i class="fa-regular fa-calendar me-1"></i> {{ text.date.strftime('%Y-%m-%d') if text.date else 'N/A' }}</small>
                            </div>
                            
                            <h5 class="mb-3 text-truncate fw-bold">{{ text.title }}</h5>
                            
                            <div class="text-preview mb-3 flex-grow-1">
                                <p class="text-muted small mb-0">{{ text.data[:150] }}...</p>
                            </div>

                            {% if text.summaries %}
                            <div class="summary-preview p-3 mb-3 rounded border" style="background: rgba(108, 92, 231, 0.03); border-color: rgba(108, 92, 231, 0.1) !important;">
                                <small class="fw-bold d-block text-primary mb-1"><i class="fa-solid fa-wand-magic-sparkles me-1"></i> Summary:</small>
                                <p class="mb-0 small fst-italic">{{ text.summaries[0].abs[:100] }}...</p>
                            </div>
                            {% endif %}

                            <a href="{{ url_for('routes1.dashboard') }}#text-card-{{text.id}}" class="btn btn-primary rounded-pill w-100 mt-auto">Details</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="glass-card text-center p-5 opacity-75">
                    <p class="text-muted mb-0">No summaries found for this query.</p>
                </div>
                {% endif %}
            </div>

            <!-- Chats Tab -->
            <div class="tab-pane fade" id="chats" role="tabpanel">
                {% if chats|length > 0 %}
                <div class="vstack gap-3">
                    {% for chat in chats %}
                    <div class="glass-card p-4 border-start border-4 border-primary shadow-sm">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div class="d-flex align-items-center">
                                <div class="icon-circle bg-primary text-white me-3" style="width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    <i class="fa-regular fa-comment-dots fa-lg"></i>
                                </div>
                                <div>
                                    <h6 class="mb-0 fw-bold">{{ chat.data[:120] }}{% if chat.data|length > 120 %}...{% endif %}</h6>
                                    <small class="text-muted"><i class="fa-regular fa-clock me-1"></i> {{ chat.date.strftime('%Y-%m-%d %H:%M') if chat.date else 'N/A' }}</small>
                                </div>
                            </div>
                            <a href="{{ url_for('routes1.dashboard') }}#chat-card-{{chat.id}}" class="btn btn-sm btn-outline-primary rounded-pill px-3">View</a>
                        </div>
                        {% if chat.responses %}
                        <div class="bg-light-transparent p-3 rounded mt-2 border-start border-3 border-secondary" style="background: rgba(0,0,0,0.02);">
                            <small class="fw-bold text-secondary d-block mb-1"><i class="fa-solid fa-robot me-1"></i> AI Response:</small>
                            <p class="mb-0 small text-muted">{{ chat.responses[0].data[:250] }}...</p>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="glass-card text-center p-5 opacity-75">
                    <p class="text-muted mb-0">No chat messages found for this query.</p>
                </div>
                {% endif %}
            </div>
        </div>
    {% endif %}

</div>

<script>
    document.addEventListener("DOMContentLoaded", (event) => {
        gsap.from(".glass-card", {
            duration: 0.6, 
            y: 30, 
            opacity: 0, 
            stagger: 0.1, 
            ease: "power2.out"
        });
        gsap.from(".nav-pills", {duration: 0.8, opacity: 0, y: 10, ease: "power2.out"});
    });
</script>

<style>
    .nav-pills .nav-link {
        color: var(--text-muted);
        background: rgba(255, 255, 255, 0.4);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-weight: 500;
    }
    .nav-pills .nav-link.active {
        background: var(--primary-color) !important;
        color: white !important;
        box-shadow: 0 8px 25px rgba(108, 92, 231, 0.3);
        transform: translateY(-2px);
    }
    .nav-pills .nav-link:hover:not(.active) {
        background: rgba(255, 255, 255, 0.8);
        color: var(--primary-color);
        transform: translateY(-1px);
    }
    .tab-content {
        animation: fadeIn 0.4s ease-out;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>
{% endblock content %}
